# 説明

Akashic-sac は [coeフレームワーク](https://github.com/akashic-games/coe)
を参考に作られた、\
サーバー・クライアント（風）を実現するためのライブラリです\

_**注意点として、このライブラリを使う場合、シーンは１つしか利用できません。**_


## 用語

プレイ端末：ゲームを実行している各デバイス（ブラウザ, ニコ生アプリ等）\
サーバー端末：プレイ端末の内の絶対に１つだけ存在する. サーバーの役割を担っている特別な端末\
クライアントインスタンス：全プレイ端末に存在する. プログラム内のインスタンス\
サーバーインスタンス：サーバー端末にのみ存在する. プログラム内のインスタンス

## 使い方

このライブラリではサーバーとクライアントを明確に分離してゲームを作ることが出来る。\
サーバーは`ServerBase`クラスを継承し、\
クライアントは`ClientBase`クラスを継承する。\
また、`Action`クラスを継承してサーバー・クライアント間の送受信データを作成する。

[サンプルリポジトリ](サンプルリポジトリ)を利用して３つのクラスの説明する。

### mainメソッド

`initializedStart`に、`Akashic-sac`内部で初期化をする時に実行する処理を渡します。\
具体的には、`ClientBase`,`ServerBase`を継承したクラスの生成を行います。
```typescript
function main(param: g.GameMainParameterObject): void {
\initializedStart(() => {
\\const client = new Client({ game: g.game });
\\const server = new Server({ client });
\});
}
```

### ServerBaseクラス

上記の[用語](#用語)にある`サーバーインスタンス`のことです。\
ゲーム中のグローバルなデータを管理し、各クライアントから送られたイベントを処理します。

[サンプルリポジトリ](サンプルリポジトリ)では、

### ClientBaseクラス


## 概要

### Akashic Enigne内部の話

ゲームがニコ生で実行された場合プレイ端末は\
**サーバー + 生主 + リスナーの総数**\
だけ存在する。\
※このサーバーはサーバー端末であり、運営のサーバー（たぶん`ak.cdn.nimg.jp`）に存在する。

**[イベントの説明]**\
サーバー端末は特殊な処理（グローバルイベントの仲介等）を行っていて、例えば
1. プレイ端末AがイベントX送信
2. サーバー端末がイベントXを受信し、各プレイ端末（サーバー端末を含む）に転送
3. 各プレイ端末がイベントXを受信

という動作を行っている。

普通のアカシックエンジンでのゲーム開発は、\
上記の **2** の部分をゲーム開発者が考慮することはなく、\
インスタンスAがイベントを送信 → インスタンスA含む全インスタンスがイベントを受信\
という風にＰ２Ｐのような方式でゲームを開発していく

このライブラリではサーバー端末でのみサーバーインスタンスを実行することで、\
サーバーとクライアントを明確に分けて開発を進めることができる。\

#### もう少し詳しい説明

Akashic Enigneはグローバルイベントをフィルタする関数を追加する\
`g.game.addEventFilter`メソッドを提供している。
[公式ドキュメント](https://akashic-games.github.io/reference/akashic-engine-v3/classes/game.html#addeventfilter)\
これを利用することで、上記の **[イベントの説明]** の２の部分で\
1. イベントの受信
2. 転送するイベントのフィルタ
3. フィルタ後のイベントを転送

を実現することが出来る。\
このライブラリ中の`ServerBase.onEventFilterd`がイベントフィルタであり、\
以下の処理を行っている
* `ClientBase.sendAction`から送られたイベントの場合、



## メモ

特定のプレイ端末にのみイベントを送信するとかそういう機能はない\
（アカシックエンジン的にそういう事が不可能。特定プレイ端末以外は受け取っても無視するしか無い）
